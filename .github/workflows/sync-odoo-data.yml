name: ğŸ”„ Sync Odoo Data to Supabase

on:
  # ØªØ´ØºÙŠÙ„ ÙŠÙˆÙ…ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 2 ØµØ¨Ø§Ø­Ø§Ù‹ (UTC+3)
  schedule:
    - cron: '0 23 * * *'  # 2 AM UTC+3 = 11 PM UTC
  
  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ù…Ù† GitHub Actions
  workflow_dispatch:
  
  # ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹ Ø¥Ù„Ù‰ main (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  # push:
  #   branches: [main]

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Clone Repository
        uses: actions/checkout@v4
      
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
      
      - name: ğŸ“¦ Install Dependencies
        run: |
          npm install node-fetch @supabase/supabase-js
      
      - name: ğŸš€ Run Sync Script
        env:
          ODOO_URL: ${{ secrets.ODOO_URL }}
          ODOO_DB: ${{ secrets.ODOO_DB }}
          ODOO_USERNAME: ${{ secrets.ODOO_USERNAME }}
          ODOO_PASSWORD: ${{ secrets.ODOO_PASSWORD }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
        run: |
          node scripts/sync_odoo.mjs
      
      - name: ğŸ“§ Send Notification
        if: always()
        uses: actions/github-script@v7
        with:
          script: |
            const status = '${{ job.status }}';
            const message = status === 'success' 
              ? 'âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­'
              : 'âŒ ÙØ´Ù„Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
            
            console.log(message);
